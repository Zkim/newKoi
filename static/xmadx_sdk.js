!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Ald=n()}(this,function(){function t(){return new Promise(function(t){wx.getSetting({success(n){n.authSetting["scope.userInfo"]?wx.getUserInfo({success(n){t(n)},fail(){t("")}}):t("")},fail(){t("")}})})}function n(){return new Promise(function(t){wx.getNetworkType({success(n){t(n)},fail(){t("")}})})}function e(){return new Promise(function(t){wx.getSetting({success(n){n.authSetting["scope.userLocation"]?wx.getLocation({type:"wgs84",success(n){t(n)},fail(){t("")}}):t("")},fail(){t("")}})})}function a(a){Promise.all([t(),n(),e()]).then(function(t){ft.user_info=lt=t[0]||{},ft.nt=gt=t[1].networkType||"",ft.lat=mt=t[2].latitude||0,ft.long=ht=t[2].longitude||0,a&&a()})}function o(n){this.$wepy&&(et="wepy"),yt=n,_t=O(),lt||t().then(function(t){lt=t}),Y.getOpenid&&!T()&&wx.login({success:function(t){i(t.code)}}),D("app","show")}function i(t){dt>=5||(dt++,wx.request({url:j()+"authorize/mini_program_openid",data:{jc:t,ai:it,reqid:M(1)},method:"post",success:function(n){if(200!=n.data.code)return void setTimeout(function(){i(t)},500);wx.setStorageSync("xm_m_openid",n.data.data.openid),r()},fail:function(n){setTimeout(function(){i(t)},500)}}))}function r(){for(var t=0;t<pt.length;t++)T(),pt[t]()}function c(){D("app","hide")}function u(t){var n=this;if(bt=this,"wepy"===et&&V.call(n),St=this.root||this.$route,n.data.xmId){var e=n.data.xmId;for(var a in e)"banner"===a&&"Array"===Object.prototype.toString.call(e[a]).split(" ")[1].slice(0,-1)?e[a].forEach(function(t){return s.call(n,t)}):s.call(n,e[a])}}function d(){var t=this.options.xmadH5url;t&&(t=t.replace("|","?").replace("$","="),this.setData({xmadURL:t}))}function p(t,n){var e=$.call(this,n),a=t.currentTarget.dataset.id,o={};"mpvue"===et?(o=e.adData,o.hasshow=!1,e.adData=o):(o=e.data.adData,o[a].hasshow=!1,e.setData({adData:o}))}function s(t,n){function e(n){if(200==n.data.code){var e=n.data.data,a=C(e.ct);if(!a)return;var i=st[a.dClass],r={xmId:t,adType:e.ct,actionType:e.at,hasshow:!0,adImage:e.imgurl,style:i,isShowIcon:e.isShowIcon,appImage:e.appimg,isExposure:0,exposureId:e.iurl,clickId:e.curl,targerAppId:e.appid,targetPath:e.pageurl,targetParams:""};if("mpvue"===et)o.adData=r;else{var c=o.data.adData||{};c[t]=r,o.setData({adData:c})}"mpvue"!==et&&"function"==typeof o.xmadSuccess&&o.xmadSuccess(t,r),"mpvue"===et&&"function"==typeof o.$parent.xmadSuccess&&o.$parent.xmadSuccess(t,r)}else 202==n.data.code&&console.warn(`广告位ID${t}未匹配到广告`),"mpvue"!==et&&"function"==typeof o.xmadFail&&o.xmadFail(t,n.data.code,n.data.msg),"mpvue"===et&&"function"==typeof o.$parent.xmadFail&&o.$parent.xmadFail(t,n.data.code,n.data.msg)}var o="wepy"===et?this:$.call(this,n);if(t)return 32!=t.length?void console.warn(`广告位ID应为长度为32位，请检查您在js中'xmad'的配置--${adId}`):void(gt?k(t,e):a(function(){k(t,e)}))}function f(t,n){var e=$.call(this,n),a=t.target.dataset.id,o={};if(o="mpvue"===et?e.adData:e.data.adData[a],0===o.isExposure){var i=o.exposureId.split("?")[1];if(1===o.adType){var r=wx.createIntersectionObserver(H(e),{thresholds:[.2],selectAll:!0});r.relativeToViewport().observe("."+a,function(t){if(t.intersectionRatio>.2){var n={};"mpvue"===et?(n=e.adData,n.isExposure=1,e.adData=n):(n=e.data.adData,n.isExposure=1,e.setData({adData:n})),A(i,"exposure",a),r.disconnect()}})}else{var c={};"mpvue"===et?(c=e.adData,c.isExposure=1,e.adData=c):(c=e.data.adData,c.isExposure=1,e.setData({adData:c})),A(i,"exposure",a)}}}function l(t,n){var e=$.call(this,n),a=t.target.dataset.id,o={};o="mpvue"===et?e.adData:e.data.adData[a];var i=o.clickId.replace(/cst=/gi,"cst="+Date.now()).split("?")[1],r=o.actionType,c=o.targerAppId,u=__wxConfig.navigateToMiniProgramAppIdList||[],d=c[1];if(c.length>1&&u.indexOf(d)!==-1){var p=o.targetPath;if(p.indexOf("?")!==-1)var s="&i="+i+"&mrid="+M(a)+"&mo="+ut;else var s="?i="+i+"&mrid="+M(a)+"&mo="+ut;var f="";f=p?p+s:"pages/index/index"+s,A(i,"click",a),wx.navigateToMiniProgram({appId:d,path:f,envVersion:1===tt?"trial":"release",success:function(){},fail:function(t){t.errMsg.indexOf("cancel")!==-1?A(i,"cancel",a):t.errMsg.indexOf("not in navigateToMiniProgramAppIdList")!==-1&&A(i,"notInList",a)}})}else if(1===r){let t=Y.h5_path||wepy?"/pages/xmadH5":"/pages/xmadH5/xmadH5",n=o.h5link.replace("?","|").replace("=","$");n&&wx.navigateTo({url:t+"?xmadH5url="+n,success:function(){A(i,"click",a)},fail:function(){console.warn("小盟提示：跳转H5广告失败，请在xmadx_conf.js中正确配置h5_path字段。")}})}else if(7===r){var l,g=o.page,h=nt,m=ct,x=o.isAccredit,v=i,w=q();1==g.purpose&&(l=vt),2==g.purpose&&(l=xt),3==g.purpose&&(l=wt),l&&wx.navigateTo({url:`/${l}?xmadPage=${g.config}&title=${g.title}&pagekey=${g.page_key}&appkey=${h}&ukey=${m}&hasAuth=${x}&bs=${w}&cu=${v}`,success:function(){A(i,"click",a)},fail:function(t){console.warn(t,"小盟提示：跳转失败，请检查内置广告页是否配置正确。")}})}else wx.previewImage({current:o.appImage,urls:[o.appImage],success:function(){A(i,"click")}})}function g(){return{adData:Object}}function h(){return{show(){var t=this.dataset.id;if(this.setData({adID:t}),"wepy"===et&&V.call(bt),t)return s.call(bt,t)}}}function m(){return{AdLoadEvent:x,AdCloseEvent:v,AdClickEvent:w}}function x(){this.triggerEvent("adLoad")}function v(t){this.triggerEvent("adClose")}function w(t){this.triggerEvent("adClick")}function y(t){var n={};for(var e in t)"onShow"!==e&&"onHide"!==e&&(n[e]=t[e]);return n.onShow=function(n){o.call(this,n),t.onShow&&"function"==typeof t.onShow&&t.onShow.call(this,n)},n.onHide=function(){c.call(this),t.onHide&&"function"==typeof t.onHide&&t.onHide.call(this)},n}function _(t){var n={};for(var e in t)"onLoad"!==e&&"onShow"!==e&&"xmadClose"!==e&&"adImgLoad"!==e&&"appoIntView"!==e&&(n[e]=t[e]);return n.onLoad=function(n){u.call(this,n),"function"==typeof t.onLoad&&t.onLoad.call(this,n)},n.onShow=function(n){d.call(this,n),"function"==typeof t.onLoad&&t.onShow.call(this,n)},n.xmadClose=function(){p.call(this),"function"==typeof t.xmadClose&&t.onLoad.call(this,options)},n.adImgLoad=function(){f.call(this),"function"==typeof t.adImgLoad&&t.onLoad.call(this,options)},n.appoIntView=function(){l.call(this),"function"==typeof t.appoIntView&&t.onLoad.call(this,options)},n}function S(){var t=Component;Component=function(n){n.xmad&&(n.properties=g(),n.methods=m(),n.pageLifetimes=h());var e=n.methods||{};z(e,"onLoad",u),z(e,"onShow",d),t(n)}}function b(t){return App(y(t))}function I(t){return Page(_(t))}function D(t,n){function e(){var e=L();e.ev=t,e.life=n,e.at=_t,e.st=Date.now(),e.wsr=yt,e.uu=ct,e.v=Z,e.ak=nt,e.ifo=rt,ut||T();var a={M_openid:ut||"",M_name:ot,M_appid:it,M_icon:at};wx.request({header:a,method:"post",url:j()+"v1/api/media/analytics",data:e})}ut?e():pt.push(e)}function k(t,n){function e(){var a=L();a.ak=nt,a.pp=St,a.uuid=ct,a.v=Z,a.wrs=yt,a.reqid=M(t),a.asid=t;var o=0;ut||T();var i={M_openid:ut,M_name:ot,M_appid:it,M_icon:at};wx.request({header:i,url:q()+"v1/api/ad",data:a,method:"post",success:function(t){n&&n(t)},fail:function(){o<2&&(o++,a.retryTimes=o,e())}})}ut?e():pt.push(e)}function A(t,n,e){var a=L(),o=(j(),"");"exposure"===n?(o="imp",a.iurl=t):"click"===n?(o="clk",a.curl=t):"cancel"===n&&(o="cancelclk",a.curl=t),a.ak=nt,a.pp=St,a.uuid=ct,a.v=Z,a.wrs=yt,a.reqid=M(e),a.asid=e;ut||T();var i={M_openid:ut,M_name:ot,M_appid:it,M_icon:at};wx.request({data:a,header:i,url:j()+"v1/api/"+o,method:"post"})}function M(t){return X(Date.now()+nt+ct+t)}function C(t){switch(t){case 1:return{dTag:"xm_banner",dClass:"banner_style"};case 2:return{dTag:"xm_insert",dClass:"screen_style"};case 3:return{dTag:"xm_fixed",dClass:"fixed_style"};default:return}}function L(){var t={};for(var n in ft)t[n]=ft[n];return t}function P(t,n){Object.defineProperty(wx,t,{value:n,writable:!1,enumerable:!0,configurable:!0})}function T(){var t="";try{ut=t=wx.getStorageSync("xm_m_openid")}catch(n){ut=t=wx.getStorageSync("xm_m_openid")}if(""===t)try{t&&wx.setStorageSync("xm_m_openid",t)}catch(n){t&&wx.setStorageSync("xm_m_openid",t)}return t}function E(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+t()+t()+t()+t()+t()+t()}function O(){return""+Date.now()+Math.floor(1e7*Math.random())}function H(t){if("wepy"!==et)return"mpvue"===et?t.$options.parent.$mp.page:t}function $(t){return"wepy"===et?this.$wx:"mpvue"===et?t:this}function q(){return 1===tt?"http://172.81.208.169:9292/":"https://engine.xmadx.net/"}function j(){return 1===tt?"http://172.81.208.169:7292/":"https://log.xmadx.net/"}function z(t,n,e){if(t[n]){var a=t[n];t[n]=function(t){e.call(this,t,n),a.call(this,t)}}else t[n]=function(t){e.call(this,t,n)}}function V(){var t=this.$wepy;z(t,"adClose",p),z(t,"adLoad",f),z(t,"adClick",l)}function F(t,n){var e=(65535&t)+(65535&n);return(t>>16)+(n>>16)+(e>>16)<<16|65535&e}function R(t,n){return t<<n|t>>>32-n}function U(t,n,e,a,o,i){return F(R(F(F(n,t),F(a,i)),o),e)}function J(t,n,e,a,o,i,r){return U(n&e|~n&a,t,n,o,i,r)}function N(t,n,e,a,o,i,r){return U(n&a|e&~a,t,n,o,i,r)}function W(t,n,e,a,o,i,r){return U(n^e^a,t,n,o,i,r)}function B(t,n,e,a,o,i,r){return U(e^(n|~a),t,n,o,i,r)}function G(t){for(var n=1732584193,e=-271733879,a=-1732584194,o=271733878,i=0;i<t.length;i+=16){var r=n,c=e,u=a,d=o;n=J(n,e,a,o,t[i+0],7,-680876936),o=J(o,n,e,a,t[i+1],12,-389564586),a=J(a,o,n,e,t[i+2],17,606105819),e=J(e,a,o,n,t[i+3],22,-1044525330),n=J(n,e,a,o,t[i+4],7,-176418897),o=J(o,n,e,a,t[i+5],12,1200080426),a=J(a,o,n,e,t[i+6],17,-1473231341),e=J(e,a,o,n,t[i+7],22,-45705983),n=J(n,e,a,o,t[i+8],7,1770035416),o=J(o,n,e,a,t[i+9],12,-1958414417),a=J(a,o,n,e,t[i+10],17,-42063),e=J(e,a,o,n,t[i+11],22,-1990404162),n=J(n,e,a,o,t[i+12],7,1804603682),o=J(o,n,e,a,t[i+13],12,-40341101),a=J(a,o,n,e,t[i+14],17,-1502002290),e=J(e,a,o,n,t[i+15],22,1236535329),n=N(n,e,a,o,t[i+1],5,-165796510),o=N(o,n,e,a,t[i+6],9,-1069501632),a=N(a,o,n,e,t[i+11],14,643717713),e=N(e,a,o,n,t[i+0],20,-373897302),n=N(n,e,a,o,t[i+5],5,-701558691),o=N(o,n,e,a,t[i+10],9,38016083),a=N(a,o,n,e,t[i+15],14,-660478335),e=N(e,a,o,n,t[i+4],20,-405537848),n=N(n,e,a,o,t[i+9],5,568446438),o=N(o,n,e,a,t[i+14],9,-1019803690),a=N(a,o,n,e,t[i+3],14,-187363961),e=N(e,a,o,n,t[i+8],20,1163531501),n=N(n,e,a,o,t[i+13],5,-1444681467),o=N(o,n,e,a,t[i+2],9,-51403784),a=N(a,o,n,e,t[i+7],14,1735328473),e=N(e,a,o,n,t[i+12],20,-1926607734),n=W(n,e,a,o,t[i+5],4,-378558),o=W(o,n,e,a,t[i+8],11,-2022574463),a=W(a,o,n,e,t[i+11],16,1839030562),e=W(e,a,o,n,t[i+14],23,-35309556),n=W(n,e,a,o,t[i+1],4,-1530992060),o=W(o,n,e,a,t[i+4],11,1272893353),a=W(a,o,n,e,t[i+7],16,-155497632),e=W(e,a,o,n,t[i+10],23,-1094730640),n=W(n,e,a,o,t[i+13],4,681279174),o=W(o,n,e,a,t[i+0],11,-358537222),a=W(a,o,n,e,t[i+3],16,-722521979),e=W(e,a,o,n,t[i+6],23,76029189),n=W(n,e,a,o,t[i+9],4,-640364487),o=W(o,n,e,a,t[i+12],11,-421815835),a=W(a,o,n,e,t[i+15],16,530742520),e=W(e,a,o,n,t[i+2],23,-995338651),n=B(n,e,a,o,t[i+0],6,-198630844),o=B(o,n,e,a,t[i+7],10,1126891415),a=B(a,o,n,e,t[i+14],15,-1416354905),e=B(e,a,o,n,t[i+5],21,-57434055),n=B(n,e,a,o,t[i+12],6,1700485571),o=B(o,n,e,a,t[i+3],10,-1894986606),a=B(a,o,n,e,t[i+10],15,-1051523),e=B(e,a,o,n,t[i+1],21,-2054922799),n=B(n,e,a,o,t[i+8],6,1873313359),o=B(o,n,e,a,t[i+15],10,-30611744),a=B(a,o,n,e,t[i+6],15,-1560198380),e=B(e,a,o,n,t[i+13],21,1309151649),n=B(n,e,a,o,t[i+4],6,-145523070),o=B(o,n,e,a,t[i+11],10,-1120210379),a=B(a,o,n,e,t[i+2],15,718787259),e=B(e,a,o,n,t[i+9],21,-343485551),n=F(n,r),e=F(e,c),a=F(a,u),o=F(o,d)}return[n,e,a,o]}function K(t){for(var n="0123456789abcdef",e="",a=0;a<4*t.length;a++)e+=n.charAt(15&t[a>>2]>>a%4*8+4)+n.charAt(15&t[a>>2]>>a%4*8);return e}function Q(t){for(var n=1+(t.length+8>>6),e=Array(16*n),a=0;a<16*n;a++)e[a]=0;for(var a=0;a<t.length;a++)e[a>>2]|=(255&t.charCodeAt(a))<<a%4*8;return e[a>>2]|=128<<a%4*8,e[16*n-2]=8*t.length,e}function X(t){return K(G(Q(t)))}var Y=require("./xmadx_conf");Y.app_key&&32===Y.app_key.length||console.warn("小盟提示：配置错误，请在xmadx_conf.js中正确配置您的app_key。");var Z="1.5.3",tt=0,nt=Y.app_key,et="",at=__wxConfig.accountInfo.icon,ot=escape(__wxConfig.accountInfo.nickname),it=__wxConfig.accountInfo.appId,rt=!1,ct=function(){var t="";try{t=wx.getStorageSync("xmaduuid")}catch(n){t="xmaduuid"}if(t)rt=!1;else{t=E();try{wx.setStorageSync("xmaduuid",t),rt=!0}catch(t){wx.setStorageSync("xmaduuid","xmaduuid")}}return t}(),ut=T(),dt=0,pt=[],st={banner_style:{wrap:"position: relative; display: flex; width: 100%; overflow: hidden",img:"width: 100%; margin: 0 auto;",icon:"position: absolute; left: 2rpx; bottom: 2rpx; width: 76rpx !important; height: 24rpx !important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; color: #fff; text-align: center; border-radius: 16rpx;",nav:"position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;"},screen_style:{wrap:"position: fixed; width: 100%; height: 100%; left: 0; top: 0; background: rgba(0, 0, 0, .3); z-index: 9999;",content:"position: relative; display: flex; width: 600rpx !important; overflow: hidden; left: calc(50% - 300rpx); top: calc(50% - 250rpx)",img:"width: 100%;",close:"position: absolute; top: 0; right: 0; width: 34rpx !important; height: 34rpx !important; padding: 10rpx; z-index: 2",nav:"position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;",icon:"position: absolute; left: 2rpx; bottom: 2rpx; width: 76rpx !important; height: 24rpx !important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; color: #fff; text-align: center; border-radius: 16rpx;"},fixed_style:{wrap:"position: fixed; display: flex; width: 120rpx !important; right: 60rpx; bottom: 60rpx; z-index: 9998;",img:"width: 100%; position:relative;z-index:9997;",nav:"position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;"}},ft={drop:{}},lt={},gt="",ht="",mt="",xt="pages/xmadPage/sell",vt="pages/xmadPage/collect",wt="pages/xmadPage/copyInfo",yt={},_t="",St="",bt={};try{var It=wx.getSystemInfoSync();ft.wv=It.version,ft.pb=It.brand,ft.br=It.brand,ft.pm=It.model,ft.pr=It.pixelRatio,ft.ww=It.screenWidth,ft.wh=It.screenHeight,ft.lang=It.language,ft.wvv=It.version,ft.sv=It.system,ft.pv=It.platform}catch(t){}var Dt=["xmAdSednOpenid","xmAdMpvueInit"],kt={xmAdSednOpenid:function(t){if(!Y.getOpenid){if(""===t||!t||28!==t.length)return void console.error("openID不和法");wx.setStorageSync("xm_m_openid",t),r()}},xmAdMpvueInit:function(t){this.$mp.page.setData({xmad:{ad:t,adData:{}}})}};if(a(),function(){var t=__wxConfig.pages,n=t.some(function(t){return t===xt}),e=t.some(function(t){return t===vt}),a=t.some(function(t){return t===a});ft.drop.hasSell=n||!1,ft.drop.hasCollect=e||!1,ft.drop.hasCopy=a||!1}(),function(){for(var t=0;t<Dt.length;t++)P(Dt[t],kt[Dt[t]])}(),Y.plugin)return S(),{App:b,Page:I,MpvueApp:MpvueApp,MpvuePage:MpvuePage};global.webpackJsonpMpvueIsInit&&(et="mpvue"),function(){!function(){var t=App,n=Page;App=function(n){z(n,"onShow",o),z(n,"onHide",c),t(n)},Page=function(t){z(t,"onLoad",u),z(t,"onShow",d),z(t,"adClose",p),z(t,"adLoad",f),z(t,"adClick",l),"mpvue"===et&&(t.pageOngetAdInfo=s,t.pageOnAdExposureEvent=f,t.pageOnAdClickEvent=l,t.pageOnAdCloseEvent=p),n(t)},S()}()}()});